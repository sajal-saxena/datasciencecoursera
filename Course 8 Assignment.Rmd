---
title: "Course 8 Assignment"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Prediction Assignment Writeup

### Instructions
The goal of your project is to predict the manner in which they did the exercise. This is the "classe" variable in the training set. You may use any of the other variables to predict with. You should create a report describing how you built your model, how you used cross validation, what you think the expected out of sample error is, and why you made the choices you did. You will also use your prediction model to predict 20 different test cases.

### Prediction Analysis

First We will load the Training and Test data set. 

```{r cars}
if(!file.exists('pml_training.csv')){
  
  download.file('https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv', destfile = './pml_training.csv')
  
}

if(!file.exists('pml_testing.csv')){
  
  download.file('https://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv', destfile = './pml_testing.csv')
  
}

pml_train_data <-  read.csv('pml_training.csv', na.strings = c("NA","#DIV/0!",""))
pml_testing_data <-  read.csv('pml_testing.csv',na.strings = c("NA","#DIV/0!",""))

```


To perform the prediction Analysis we take Train Data set and divide it into train and test data set

```{r}
library(caret)
set.seed(123456)

intrain <- createDataPartition(y= pml_train_data$classe, p = 0.8 , list = F)
training <- pml_train_data[intrain, ]
testing <- pml_train_data[-intrain, ]

dim(training)
dim(testing)
```

We clean the Train Data set 

```{r}
# Removing the Near Zero Variance Data

nzv_columns <- nearZeroVar(training)
train <- training[ , -nzv_columns]
dim(training)

# Removing volumes which has missing values more then 60%
lngth <- sapply(training, function(x){ 
                       sum(!(is.na(x) | x == ""))
                        })

nullcol <- names(lngth[lngth < 0.6 * length(training$classe)])
descriptcol <- c("X", "user_name", "raw_timestamp_part_1", "raw_timestamp_part_2", 
    "cvtd_timestamp", "new_window", "num_window")
excludecols <- c(descriptcol, nullcol)
training <- training[, !names(training) %in% excludecols]
dim(training)
```

###Train Data Modal

We will use Random Forset as our model for Train Data

```{r}
library(randomForest)

train_modal <- randomForest(classe ~., data = training, importance = T, ntrees = 10)
train_pedict <- predict(train_modal, training)
confusionMatrix(train_pedict, training$classe)
```

Lets run the model to the Validation (test set from original training set)


```{r}
test_predict <- predict(train_modal,testing)
confusionMatrix(test_predict,testing$classe)
```

### Prediction the Original Test Data Set

```{r}
pml_testing_prediction <- predict(train_modal,pml_testing_data)
pml_testing_prediction
```

